{% extends 'base.html' %}

{% block content %}

<script type="text/javascript" src="{{ STATIC_URL }}jquery-1.4.js"></script>
{% include "rating.html" %}
<script type="text/javascript">
   function sendBet(){
       if ($('[name="radios"]:checked').length != 0) {
           var player_id = $('[name="radios"]:checked').val();
           var home_score = $('#home_score').val();
           var away_score = $('#away_score').val();
           $.post("/betting/", {home_score: home_score,away_score: away_score, goalscorer: player_id, match_id:"{{match.id}}"},
                function(data) {
                    $('#alert-message')[0].innerHTML = '<span>'+data+'</span>';
                    setTimeout(function() {
                        window.location.reload(true);
                    }, 1500);
                });
       } else {
           $('#alert-message')[0].innerHTML = '<span>Please pick a goalscorer!</span>';
       }

   }

   function sendResult(){
           var home_score = $('#home_result').val();
           var away_score = $('#away_result').val();
           $.post("/addresult/", {home_score: home_score,away_score: away_score, match_id:"{{match.id}}"},
                function(data) {
                    $('#alert-message')[0].innerHTML = '<span>'+data+'</span>';
                    setTimeout(function() {
                        window.location.reload(true);
                    }, 1500);
                });
   }
   function sendGoals(){
       var goalscorer = $('#goalscorer').val();
       $.post("/addgoal/", {goalscorer:goalscorer, match_id:"{{match.id}}"},
            function(data) {
                $('#alert-message')[0].innerHTML = '<span>'+data+'</span>';
                setTimeout(function() {
                    window.location.reload(true);
                }, 1500);
            });
   }

   function addPoints(){
       $.post("/addpoints/", {match_id:"{{match.id}}"},
            function(data) {
                $('#alert-message')[0].innerHTML = '<span>'+data+'</span>';
                setTimeout(function() {
                    window.location.reload(true);
                }, 1500);
            });
   }
</script>


<div id="alert-message"> </div>
x: {{ datata }}<br>
now {{ now }}<br>
{{ is_started }}
{{ user_bet.goalscorer }}
{% if allowed %}
    Moderator
    {% if not is_over %}
<input type="number" id="home_result" value="" min="0" max="20"> :
<input type="number" id="away_result" value="" min="0" max="20">
<input type="submit" onclick="sendResult()" value="Add result">
        <br>
<select id="goalscorer">
{% for player, vote in votes_players_host.items %}
  <option value="{{ player.id }}">{{ player }}</option>
{% endfor %}
{% for player, vote in votes_players_away.items %}
  <option value="{{ player.id }}">{{ player }}</option>
{% endfor %}
</select>
 <input type="submit" onclick="sendGoals()" value="Add goalscorers">
 make sure you typed the score and goalscorers!!
 <input type="submit" onclick="addPoints()" value="Give Points!!!">
    {% endif %}
 {% else %}
    Normal User
 {% endif %}
<br>
BETS:
<br>

        <br>
{% for bet,points in bets.items %}
    <b>{{ bet.0 }}</b>
    <b>{{ bet.0.id }}</b>
     result: {{ bet.1 }}: {{ bet.2 }}
     goalscorer: {{ bet.3.name }}
     points: {{ points }}
        <br>
{% endfor %}
<br>
<br>
Is Over: {{ is_over }}

        <br>

<b>{{ match.host }}</b>
vs
<b>{{ match.away }}</b>

 {{ match.score_host }} : {{ match.score_away }}
<br>
goalscorers:
<br>
{% for goalscorer in goalscorers %}
{{ goalscorer }}
    <br>
{% endfor %}
{% if is_started %}
<input type="number" id="home_score" value="{{ user_bet.score_host }}" min="0" max="20" disabled> :
<input type="number" id="away_score" value="{{ user_bet.score_away }}" min="0" max="20" disabled>
{% else %}
<input type="number" id="home_score" value="{{ user_bet.score_host }}" min="0" max="20" > :
<input type="number" id="away_score" value="{{ user_bet.score_away }}" min="0" max="20" >
<input type="submit" onclick="sendBet()">
{% endif %}

        <br>
<b>{{ match.host.name }}</b> players:
{% for player, vote in votes_players_host.items %}
        <br>
{% if player == user_bet.goalscorer %}
<input type="radio" id="radio{{player.id}}" name="radios" value="{{ player.id }}" checked>
<label for="radio{{player.id}}">{{ player }}, vote: {{ vote|floatformat }}</label>
{% else %}
<input type="radio" id="radio{{player.id}}" name="radios" value="{{ player.id }}" >
<label for="radio{{player.id}}">{{ player }}, vote: {{ vote|floatformat }}</label>
{% endif %}
 <div class="rating" id="{{player.id}}">
     {% for x in MAX_VOTE %}
         {% if vote|floatformat:0 >= x %}
            <div class="star on rating"></div>
         {% else %}
            <div class="star"></div>
         {% endif %}
     {% endfor %}
<div class="userrating" id="{{player.id}}"></div>
</div><br>
{% endfor %}
        <br>
<b>{{ match.away.name }}</b> players:
{% for player, vote in votes_players_away.items %}
        <br>
{% if player == user_bet.goalscorer %}
<input type="radio" id="radio{{player.id}}" name="radios" value="{{ player.id }}" checked>
<label for="radio{{player.id}}">{{ player }}, vote: {{ vote|floatformat }}</label>
{% else %}
<input type="radio" id="radio{{player.id}}" name="radios" value="{{ player.id }}" >
<label for="radio{{player.id}}">{{ player }}, vote: {{ vote|floatformat }}</label>
{% endif %}
<div class="rating" id="{{player.id}}">
     {% for x in MAX_VOTE %}
         {% if vote|floatformat:0 >= x %}
            <div class="star on rating"></div>
         {% else %}
            <div class="star"></div>
         {% endif %}
    {% endfor %}
<div class="userrating" id="{{player.id}}"></div>
</div><br>
{% endfor %}
        <br>

{% endblock %}